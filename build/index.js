(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.element,t=window.wp.i18n,r=window.wp.apiFetch;var a=e.n(r);const s=vmfo.shared;function i(){const[e,t]=(0,n.useState)(null),[r,s]=(0,n.useState)(!0),{nonce:i}=window.vmfaRulesEngine||{},l=(0,n.useCallback)(async()=>{s(!0);try{const e=await a()({path:"vmfa-rules/v1/stats",headers:{"X-WP-Nonce":i}});t(e)}catch(e){}finally{s(!1)}},[i]);return(0,n.useEffect)(()=>{l()},[l]),{stats:e,isLoading:r,refresh:l}}function l(){const[e,t]=(0,n.useState)(!1),[r,s]=(0,n.useState)(!1),[i,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),{nonce:d}=window.vmfaRulesEngine||{},u=(0,n.useCallback)(async(e={})=>{t(!0),c(null),l(null);try{var n,r,s,i;const t={unassigned_only:null===(n=e.unassignedOnly)||void 0===n||n,limit:null!==(r=e.limit)&&void 0!==r?r:50,offset:0,mime_type:e.mimeType,target_matches:null!==(s=e.targetMatches)&&void 0!==s?s:50,max_scan:null!==(i=e.maxScan)&&void 0!==i?i:500};e.ruleId&&(t.rule_id=e.ruleId);const o=await a()({path:"vmfa-rules/v1/preview",method:"POST",data:t,headers:{"X-WP-Nonce":d}});return l(o),o}catch(e){throw c(e.message||"Failed to preview rules"),e}finally{t(!1)}},[d]),h=(0,n.useCallback)(async(e={})=>{if(!i||!i.has_more||r)return null;s(!0),c(null);try{var n,t,o;const r=i.items.length,s={unassigned_only:null===(n=e.unassignedOnly)||void 0===n||n,limit:i.limit,offset:r,mime_type:e.mimeType,target_matches:null!==(t=e.targetMatches)&&void 0!==t?t:50,max_scan:null!==(o=e.maxScan)&&void 0!==o?o:500};i.rule_id&&(s.rule_id=i.rule_id);const c=await a()({path:"vmfa-rules/v1/preview",method:"POST",data:s,headers:{"X-WP-Nonce":d}});return l(e=>{const n=[...e.items,...c.items];return{...e,items:n,total:n.length,matched:e.matched+c.matched,unmatched:e.unmatched+c.unmatched,has_more:c.has_more}}),c}catch(e){throw c(e.message||"Failed to load more"),e}finally{s(!1)}},[d,i,r]),v=(0,n.useCallback)(async(e={})=>{t(!0),c(null),l(null);try{var n;const t=await a()({path:"vmfa-rules/v1/apply-rules",method:"POST",data:{unassigned_only:null===(n=e.unassignedOnly)||void 0===n||n,attachment_ids:e.attachmentIds,mime_type:e.mimeType},headers:{"X-WP-Nonce":d}});return l(t),t}catch(e){throw c(e.message||"Failed to apply rules"),e}finally{t(!1)}},[d]),f=(0,n.useCallback)(()=>{l(null),c(null)},[]);return{isProcessing:e,isLoadingMore:r,results:i,error:o,preview:u,loadMore:h,apply:v,clearResults:f}}const o=window.wp.components,c=window.ReactJSXRuntime;function d(){var e,r,i,l;const[d,u]=(0,n.useState)(null),[h,v]=(0,n.useState)(!0),{nonce:f}=window.vmfaRulesEngine||{},m=(0,n.useCallback)(async()=>{try{const e=await a()({path:"vmfa-rules/v1/stats",headers:{"X-WP-Nonce":f}});u(e)}catch(e){}finally{v(!1)}},[f]);(0,n.useEffect)(()=>{m()},[m]);const g=d?[{label:(0,t.__)("Total Rules","vmfa-rules-engine"),value:null!==(e=d.rules_total?.toLocaleString())&&void 0!==e?e:"—"},{label:(0,t.__)("Active Rules","vmfa-rules-engine"),value:null!==(r=d.rules_enabled?.toLocaleString())&&void 0!==r?r:"—"},{label:(0,t.__)("Total Matched","vmfa-rules-engine"),value:null!==(i=d.assigned?.toLocaleString())&&void 0!==i?i:"—"},{label:(0,t.__)("Unassigned Media","vmfa-rules-engine"),value:null!==(l=d.unassigned?.toLocaleString())&&void 0!==l?l:"—"}]:[{label:(0,t.__)("Total Rules","vmfa-rules-engine"),isLoading:h},{label:(0,t.__)("Active Rules","vmfa-rules-engine"),isLoading:h},{label:(0,t.__)("Total Matched","vmfa-rules-engine"),isLoading:h},{label:(0,t.__)("Unassigned Media","vmfa-rules-engine"),isLoading:h}];return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.StatsCard,{stats:g}),(0,c.jsxs)(o.Card,{className:"vmfo-overview-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsx)("h3",{children:(0,t.__)("About Rules Engine","vmfa-rules-engine")})}),(0,c.jsxs)(o.CardBody,{children:[(0,c.jsx)("p",{children:(0,t.__)("Rules Engine automatically organizes your media library by applying customizable rules to files as they are uploaded. Define conditions based on filename patterns, file types, upload dates, and more to ensure consistent folder organization.","vmfa-rules-engine")}),(0,c.jsx)("h4",{children:(0,t.__)("Features","vmfa-rules-engine")}),(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:(0,t.__)("Automatic folder assignment on upload","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Multiple condition types: filename, MIME type, size, date, author","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Rule priority with drag-and-drop ordering","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Preview rules before applying to existing media","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Batch operations for organizing existing files","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Stop processing option for rule chains","vmfa-rules-engine")})]}),(0,c.jsx)("h4",{children:(0,t.__)("Getting Started","vmfa-rules-engine")}),(0,c.jsxs)("ol",{children:[(0,c.jsx)("li",{children:(0,t.__)("Create rules in the Dashboard tab","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Set conditions to match specific files","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Choose a target folder for matched files","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Use Actions to apply rules to existing media","vmfa-rules-engine")})]})]})]})]})}const u=window.wp.primitives;var h=(0,c.jsx)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)(u.Path,{d:"M10 17.5H14V16H10V17.5ZM6 6V7.5H18V6H6ZM8 12.5H16V11H8V12.5Z"})}),v=(0,c.jsxs)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,c.jsx)(u.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,c.jsx)(u.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"})]}),f=(0,c.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,c.jsx)(u.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),m=(0,c.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,c.jsx)(u.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})});const g=window.React;var p=e.n(g);const x=window.ReactDOM,b="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function _(e){const n=Object.prototype.toString.call(e);return"[object Window]"===n||"[object global]"===n}function y(e){return"nodeType"in e}function w(e){var n,t;return e?_(e)?e:y(e)&&null!=(n=null==(t=e.ownerDocument)?void 0:t.defaultView)?n:window:window}function j(e){const{Document:n}=w(e);return e instanceof n}function C(e){return!_(e)&&e instanceof w(e).HTMLElement}function S(e){return e instanceof w(e).SVGElement}function N(e){return e?_(e)?e.document:y(e)?j(e)?e:C(e)||S(e)?e.ownerDocument:document:document:document}const R=b?g.useLayoutEffect:g.useEffect;function D(e){const n=(0,g.useRef)(e);return R(()=>{n.current=e}),(0,g.useCallback)(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return null==n.current?void 0:n.current(...t)},[])}function E(e,n){void 0===n&&(n=[e]);const t=(0,g.useRef)(e);return R(()=>{t.current!==e&&(t.current=e)},n),t}function k(e,n){const t=(0,g.useRef)();return(0,g.useMemo)(()=>{const n=e(t.current);return t.current=n,n},[...n])}function M(e){const n=D(e),t=(0,g.useRef)(null),r=(0,g.useCallback)(e=>{e!==t.current&&(null==n||n(e,t.current)),t.current=e},[]);return[t,r]}function I(e){const n=(0,g.useRef)();return(0,g.useEffect)(()=>{n.current=e},[e]),n.current}let T={};function B(e,n){return(0,g.useMemo)(()=>{if(n)return n;const t=null==T[e]?0:T[e]+1;return T[e]=t,e+"-"+t},[e,n])}function A(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.reduce((n,t)=>{const r=Object.entries(t);for(const[t,a]of r){const r=n[t];null!=r&&(n[t]=r+e*a)}return n},{...n})}}const F=A(1),L=A(-1);function O(e){if(!e)return!1;const{KeyboardEvent:n}=w(e.target);return n&&e instanceof n}function P(e){if(function(e){if(!e)return!1;const{TouchEvent:n}=w(e.target);return n&&e instanceof n}(e)){if(e.touches&&e.touches.length){const{clientX:n,clientY:t}=e.touches[0];return{x:n,y:t}}if(e.changedTouches&&e.changedTouches.length){const{clientX:n,clientY:t}=e.changedTouches[0];return{x:n,y:t}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const z=Object.freeze({Translate:{toString(e){if(!e)return;const{x:n,y:t}=e;return"translate3d("+(n?Math.round(n):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:n,scaleY:t}=e;return"scaleX("+n+") scaleY("+t+")"}},Transform:{toString(e){if(e)return[z.Translate.toString(e),z.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:n,duration:t,easing:r}=e;return n+" "+t+"ms "+r}}}),H="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function W(e){return e.matches(H)?e:e.querySelector(H)}const U={display:"none"};function X(e){let{id:n,value:t}=e;return p().createElement("div",{id:n,style:U},t)}function V(e){let{id:n,announcement:t,ariaLiveType:r="assertive"}=e;return p().createElement("div",{id:n,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},t)}const q=(0,g.createContext)(null),K={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},Y={onDragStart(e){let{active:n}=e;return"Picked up draggable item "+n.id+"."},onDragOver(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was moved over droppable area "+t.id+".":"Draggable item "+n.id+" is no longer over a droppable area."},onDragEnd(e){let{active:n,over:t}=e;return t?"Draggable item "+n.id+" was dropped over droppable area "+t.id:"Draggable item "+n.id+" was dropped."},onDragCancel(e){let{active:n}=e;return"Dragging was cancelled. Draggable item "+n.id+" was dropped."}};function G(e){let{announcements:n=Y,container:t,hiddenTextDescribedById:r,screenReaderInstructions:a=K}=e;const{announce:s,announcement:i}=function(){const[e,n]=(0,g.useState)("");return{announce:(0,g.useCallback)(e=>{null!=e&&n(e)},[]),announcement:e}}(),l=B("DndLiveRegion"),[o,c]=(0,g.useState)(!1);if((0,g.useEffect)(()=>{c(!0)},[]),function(e){const n=(0,g.useContext)(q);(0,g.useEffect)(()=>{if(!n)throw new Error("useDndMonitor must be used within a children of <DndContext>");return n(e)},[e,n])}((0,g.useMemo)(()=>({onDragStart(e){let{active:t}=e;s(n.onDragStart({active:t}))},onDragMove(e){let{active:t,over:r}=e;n.onDragMove&&s(n.onDragMove({active:t,over:r}))},onDragOver(e){let{active:t,over:r}=e;s(n.onDragOver({active:t,over:r}))},onDragEnd(e){let{active:t,over:r}=e;s(n.onDragEnd({active:t,over:r}))},onDragCancel(e){let{active:t,over:r}=e;s(n.onDragCancel({active:t,over:r}))}}),[s,n])),!o)return null;const d=p().createElement(p().Fragment,null,p().createElement(X,{id:r,value:a.draggable}),p().createElement(V,{id:l,announcement:i}));return t?(0,x.createPortal)(d,t):d}var J;function Z(){}function $(e,n){return(0,g.useMemo)(()=>({sensor:e,options:null!=n?n:{}}),[e,n])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(J||(J={}));const Q=Object.freeze({x:0,y:0});function ee(e,n){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function ne(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return t-r}function te(e,n){let{data:{value:t}}=e,{data:{value:r}}=n;return r-t}function re(e){let{left:n,top:t,height:r,width:a}=e;return[{x:n,y:t},{x:n+a,y:t},{x:n,y:t+r},{x:n+a,y:t+r}]}function ae(e,n){if(!e||0===e.length)return null;const[t]=e;return n?t[n]:t}function se(e,n,t){return void 0===n&&(n=e.left),void 0===t&&(t=e.top),{x:n+.5*e.width,y:t+.5*e.height}}const ie=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const a=se(n,n.left,n.top),s=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=ee(se(r),a);s.push({id:n,data:{droppableContainer:e,value:t}})}}return s.sort(ne)};function le(e,n){const t=Math.max(n.top,e.top),r=Math.max(n.left,e.left),a=Math.min(n.left+n.width,e.left+e.width),s=Math.min(n.top+n.height,e.top+e.height),i=a-r,l=s-t;if(r<a&&t<s){const t=n.width*n.height,r=e.width*e.height,a=i*l;return Number((a/(t+r-a)).toFixed(4))}return 0}const oe=e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const a=[];for(const e of r){const{id:r}=e,s=t.get(r);if(s){const t=le(s,n);t>0&&a.push({id:r,data:{droppableContainer:e,value:t}})}}return a.sort(te)};function ce(e,n){return e&&n?{x:e.left-n.left,y:e.top-n.top}:Q}function de(e){return function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.reduce((n,t)=>({...n,top:n.top+e*t.y,bottom:n.bottom+e*t.y,left:n.left+e*t.x,right:n.right+e*t.x}),{...n})}}const ue=de(1);const he={ignoreTransform:!1};function ve(e,n){void 0===n&&(n=he);let t=e.getBoundingClientRect();if(n.ignoreTransform){const{transform:n,transformOrigin:r}=w(e).getComputedStyle(e);n&&(t=function(e,n,t){const r=function(e){if(e.startsWith("matrix3d(")){const n=e.slice(9,-1).split(/, /);return{x:+n[12],y:+n[13],scaleX:+n[0],scaleY:+n[5]}}if(e.startsWith("matrix(")){const n=e.slice(7,-1).split(/, /);return{x:+n[4],y:+n[5],scaleX:+n[0],scaleY:+n[3]}}return null}(n);if(!r)return e;const{scaleX:a,scaleY:s,x:i,y:l}=r,o=e.left-i-(1-a)*parseFloat(t),c=e.top-l-(1-s)*parseFloat(t.slice(t.indexOf(" ")+1)),d=a?e.width/a:e.width,u=s?e.height/s:e.height;return{width:d,height:u,top:c,right:o+d,bottom:c+u,left:o}}(t,n,r))}const{top:r,left:a,width:s,height:i,bottom:l,right:o}=t;return{top:r,left:a,width:s,height:i,bottom:l,right:o}}function fe(e){return ve(e,{ignoreTransform:!0})}function me(e,n){const t=[];return e?function r(a){if(null!=n&&t.length>=n)return t;if(!a)return t;if(j(a)&&null!=a.scrollingElement&&!t.includes(a.scrollingElement))return t.push(a.scrollingElement),t;if(!C(a)||S(a))return t;if(t.includes(a))return t;const s=w(e).getComputedStyle(a);return a!==e&&function(e,n){void 0===n&&(n=w(e).getComputedStyle(e));const t=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=n[e];return"string"==typeof r&&t.test(r)})}(a,s)&&t.push(a),function(e,n){return void 0===n&&(n=w(e).getComputedStyle(e)),"fixed"===n.position}(a,s)?t:r(a.parentNode)}(e):t}function ge(e){const[n]=me(e,1);return null!=n?n:null}function pe(e){return b&&e?_(e)?e:y(e)?j(e)||e===N(e).scrollingElement?window:C(e)?e:null:null:null}function xe(e){return _(e)?e.scrollX:e.scrollLeft}function be(e){return _(e)?e.scrollY:e.scrollTop}function _e(e){return{x:xe(e),y:be(e)}}var ye;function we(e){return!(!b||!e)&&e===document.scrollingElement}function je(e){const n={x:0,y:0},t=we(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-t.width,y:e.scrollHeight-t.height};return{isTop:e.scrollTop<=n.y,isLeft:e.scrollLeft<=n.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:n}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(ye||(ye={}));const Ce={x:.2,y:.2};function Se(e,n,t,r,a){let{top:s,left:i,right:l,bottom:o}=t;void 0===r&&(r=10),void 0===a&&(a=Ce);const{isTop:c,isBottom:d,isLeft:u,isRight:h}=je(e),v={x:0,y:0},f={x:0,y:0},m=n.height*a.y,g=n.width*a.x;return!c&&s<=n.top+m?(v.y=ye.Backward,f.y=r*Math.abs((n.top+m-s)/m)):!d&&o>=n.bottom-m&&(v.y=ye.Forward,f.y=r*Math.abs((n.bottom-m-o)/m)),!h&&l>=n.right-g?(v.x=ye.Forward,f.x=r*Math.abs((n.right-g-l)/g)):!u&&i<=n.left+g&&(v.x=ye.Backward,f.x=r*Math.abs((n.left+g-i)/g)),{direction:v,speed:f}}function Ne(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:n}=window;return{top:0,left:0,right:e,bottom:n,width:e,height:n}}const{top:n,left:t,right:r,bottom:a}=e.getBoundingClientRect();return{top:n,left:t,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Re(e){return e.reduce((e,n)=>F(e,_e(n)),Q)}const De=[["x",["left","right"],function(e){return e.reduce((e,n)=>e+xe(n),0)}],["y",["top","bottom"],function(e){return e.reduce((e,n)=>e+be(n),0)}]];class Ee{constructor(e,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const t=me(n),r=Re(t);this.rect={...e},this.width=e.width,this.height=e.height;for(const[e,n,a]of De)for(const s of n)Object.defineProperty(this,s,{get:()=>{const n=a(t),i=r[e]-n;return this.rect[s]+i},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ke{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var n;return null==(n=this.target)?void 0:n.removeEventListener(...e)})},this.target=e}add(e,n,t){var r;null==(r=this.target)||r.addEventListener(e,n,t),this.listeners.push([e,n,t])}}function Me(e,n){const t=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof n?Math.sqrt(t**2+r**2)>n:"x"in n&&"y"in n?t>n.x&&r>n.y:"x"in n?t>n.x:"y"in n&&r>n.y}var Ie,Te;function Be(e){e.preventDefault()}function Ae(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(Ie||(Ie={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(Te||(Te={}));const Fe={start:[Te.Space,Te.Enter],cancel:[Te.Esc],end:[Te.Space,Te.Enter,Te.Tab]},Le=(e,n)=>{let{currentCoordinates:t}=n;switch(e.code){case Te.Right:return{...t,x:t.x+25};case Te.Left:return{...t,x:t.x-25};case Te.Down:return{...t,y:t.y+25};case Te.Up:return{...t,y:t.y-25}}};class Oe{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:n}}=e;this.props=e,this.listeners=new ke(N(n)),this.windowListeners=new ke(w(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ie.Resize,this.handleCancel),this.windowListeners.add(Ie.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ie.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:n}=this.props,t=e.node.current;t&&function(e,n){if(void 0===n&&(n=ve),!e)return;const{top:t,left:r,bottom:a,right:s}=n(e);ge(e)&&(a<=0||s<=0||t>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(t),n(Q)}handleKeyDown(e){if(O(e)){const{active:n,context:t,options:r}=this.props,{keyboardCodes:a=Fe,coordinateGetter:s=Le,scrollBehavior:i="smooth"}=r,{code:l}=e;if(a.end.includes(l))return void this.handleEnd(e);if(a.cancel.includes(l))return void this.handleCancel(e);const{collisionRect:o}=t.current,c=o?{x:o.left,y:o.top}:Q;this.referenceCoordinates||(this.referenceCoordinates=c);const d=s(e,{active:n,context:t.current,currentCoordinates:c});if(d){const n=L(d,c),r={x:0,y:0},{scrollableAncestors:a}=t.current;for(const t of a){const a=e.code,{isTop:s,isRight:l,isLeft:o,isBottom:c,maxScroll:u,minScroll:h}=je(t),v=Ne(t),f={x:Math.min(a===Te.Right?v.right-v.width/2:v.right,Math.max(a===Te.Right?v.left:v.left+v.width/2,d.x)),y:Math.min(a===Te.Down?v.bottom-v.height/2:v.bottom,Math.max(a===Te.Down?v.top:v.top+v.height/2,d.y))},m=a===Te.Right&&!l||a===Te.Left&&!o,g=a===Te.Down&&!c||a===Te.Up&&!s;if(m&&f.x!==d.x){const e=t.scrollLeft+n.x,s=a===Te.Right&&e<=u.x||a===Te.Left&&e>=h.x;if(s&&!n.y)return void t.scrollTo({left:e,behavior:i});r.x=s?t.scrollLeft-e:a===Te.Right?t.scrollLeft-u.x:t.scrollLeft-h.x,r.x&&t.scrollBy({left:-r.x,behavior:i});break}if(g&&f.y!==d.y){const e=t.scrollTop+n.y,s=a===Te.Down&&e<=u.y||a===Te.Up&&e>=h.y;if(s&&!n.x)return void t.scrollTo({top:e,behavior:i});r.y=s?t.scrollTop-e:a===Te.Down?t.scrollTop-u.y:t.scrollTop-h.y,r.y&&t.scrollBy({top:-r.y,behavior:i});break}}this.handleMove(e,F(L(d,this.referenceCoordinates),r))}}}handleMove(e,n){const{onMove:t}=this.props;e.preventDefault(),t(n)}handleEnd(e){const{onEnd:n}=this.props;e.preventDefault(),this.detach(),n()}handleCancel(e){const{onCancel:n}=this.props;e.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function Pe(e){return Boolean(e&&"distance"in e)}function ze(e){return Boolean(e&&"delay"in e)}Oe.activators=[{eventName:"onKeyDown",handler:(e,n,t)=>{let{keyboardCodes:r=Fe,onActivation:a}=n,{active:s}=t;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const n=s.activatorNode.current;return!(n&&e.target!==n||(e.preventDefault(),null==a||a({event:e.nativeEvent}),0))}return!1}}];class He{constructor(e,n,t){var r;void 0===t&&(t=function(e){const{EventTarget:n}=w(e);return e instanceof n?e:N(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=n;const{event:a}=e,{target:s}=a;this.props=e,this.events=n,this.document=N(s),this.documentListeners=new ke(this.document),this.listeners=new ke(t),this.windowListeners=new ke(w(s)),this.initialCoordinates=null!=(r=P(a))?r:Q,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:n,bypassActivationConstraint:t}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Ie.Resize,this.handleCancel),this.windowListeners.add(Ie.DragStart,Be),this.windowListeners.add(Ie.VisibilityChange,this.handleCancel),this.windowListeners.add(Ie.ContextMenu,Be),this.documentListeners.add(Ie.Keydown,this.handleKeydown),n){if(null!=t&&t({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(ze(n))return this.timeoutId=setTimeout(this.handleStart,n.delay),void this.handlePending(n);if(Pe(n))return void this.handlePending(n)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,n){const{active:t,onPending:r}=this.props;r(t,e,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:e}=this,{onStart:n}=this.props;e&&(this.activated=!0,this.documentListeners.add(Ie.Click,Ae,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ie.SelectionChange,this.removeTextSelection),n(e))}handleMove(e){var n;const{activated:t,initialCoordinates:r,props:a}=this,{onMove:s,options:{activationConstraint:i}}=a;if(!r)return;const l=null!=(n=P(e))?n:Q,o=L(r,l);if(!t&&i){if(Pe(i)){if(null!=i.tolerance&&Me(o,i.tolerance))return this.handleCancel();if(Me(o,i.distance))return this.handleStart()}return ze(i)&&Me(o,i.tolerance)?this.handleCancel():void this.handlePending(i,o)}e.cancelable&&e.preventDefault(),s(l)}handleEnd(){const{onAbort:e,onEnd:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleCancel(){const{onAbort:e,onCancel:n}=this.props;this.detach(),this.activated||e(this.props.active),n()}handleKeydown(e){e.code===Te.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const We={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ue extends He{constructor(e){const{event:n}=e,t=N(n.target);super(e,We,t)}}Ue.activators=[{eventName:"onPointerDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return!(!t.isPrimary||0!==t.button||(null==r||r({event:t}),0))}}];const Xe={move:{name:"mousemove"},end:{name:"mouseup"}};var Ve;!function(e){e[e.RightClick=2]="RightClick"}(Ve||(Ve={})),class extends He{constructor(e){super(e,Xe,N(e.event.target))}}.activators=[{eventName:"onMouseDown",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;return t.button!==Ve.RightClick&&(null==r||r({event:t}),!0)}}];const qe={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var Ke,Ye;(class extends He{constructor(e){super(e,qe)}static setup(){return window.addEventListener(qe.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(qe.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,n)=>{let{nativeEvent:t}=e,{onActivation:r}=n;const{touches:a}=t;return!(a.length>1||(null==r||r({event:t}),0))}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(Ke||(Ke={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(Ye||(Ye={}));const Ge={x:{[ye.Backward]:!1,[ye.Forward]:!1},y:{[ye.Backward]:!1,[ye.Forward]:!1}};var Je,Ze;!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(Je||(Je={})),function(e){e.Optimized="optimized"}(Ze||(Ze={}));const $e=new Map;function Qe(e,n){return k(t=>e?t||("function"==typeof n?n(e):e):null,[n,e])}function en(e){let{callback:n,disabled:t}=e;const r=D(n),a=(0,g.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(r)},[t]);return(0,g.useEffect)(()=>()=>null==a?void 0:a.disconnect(),[a]),a}function nn(e){return new Ee(ve(e),e)}function tn(e,n,t){void 0===n&&(n=nn);const[r,a]=(0,g.useState)(null);function s(){a(r=>{if(!e)return null;var a;if(!1===e.isConnected)return null!=(a=null!=r?r:t)?a:null;const s=n(e);return JSON.stringify(r)===JSON.stringify(s)?r:s})}const i=function(e){let{callback:n,disabled:t}=e;const r=D(n),a=(0,g.useMemo)(()=>{if(t||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(r)},[r,t]);return(0,g.useEffect)(()=>()=>null==a?void 0:a.disconnect(),[a]),a}({callback(n){if(e)for(const t of n){const{type:n,target:r}=t;if("childList"===n&&r instanceof HTMLElement&&r.contains(e)){s();break}}}}),l=en({callback:s});return R(()=>{s(),e?(null==l||l.observe(e),null==i||i.observe(document.body,{childList:!0,subtree:!0})):(null==l||l.disconnect(),null==i||i.disconnect())},[e]),r}const rn=[];function an(e,n){void 0===n&&(n=[]);const t=(0,g.useRef)(null);return(0,g.useEffect)(()=>{t.current=null},n),(0,g.useEffect)(()=>{const n=e!==Q;n&&!t.current&&(t.current=e),!n&&t.current&&(t.current=null)},[e]),t.current?L(e,t.current):Q}function sn(e){return(0,g.useMemo)(()=>e?function(e){const n=e.innerWidth,t=e.innerHeight;return{top:0,left:0,right:n,bottom:t,width:n,height:t}}(e):null,[e])}const ln=[];const on=[{sensor:Ue,options:{}},{sensor:Oe,options:{}}],cn={current:{}},dn={draggable:{measure:fe},droppable:{measure:fe,strategy:Je.WhileDragging,frequency:Ze.Optimized},dragOverlay:{measure:ve}};class un extends Map{get(e){var n;return null!=e&&null!=(n=super.get(e))?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:n}=e;return!n})}getNodeFor(e){var n,t;return null!=(n=null==(t=this.get(e))?void 0:t.node.current)?n:void 0}}const hn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new un,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Z},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:dn,measureDroppableContainers:Z,windowRect:null,measuringScheduled:!1},vn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Z,draggableNodes:new Map,over:null,measureDroppableContainers:Z},fn=(0,g.createContext)(vn),mn=(0,g.createContext)(hn);function gn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new un}}}function pn(e,n){switch(n.type){case J.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:n.initialCoordinates,active:n.active}};case J.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:n.coordinates.x-e.draggable.initialCoordinates.x,y:n.coordinates.y-e.draggable.initialCoordinates.y}}};case J.DragEnd:case J.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case J.RegisterDroppable:{const{element:t}=n,{id:r}=t,a=new un(e.droppable.containers);return a.set(r,t),{...e,droppable:{...e.droppable,containers:a}}}case J.SetDroppableDisabled:{const{id:t,key:r,disabled:a}=n,s=e.droppable.containers.get(t);if(!s||r!==s.key)return e;const i=new un(e.droppable.containers);return i.set(t,{...s,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case J.UnregisterDroppable:{const{id:t,key:r}=n,a=e.droppable.containers.get(t);if(!a||r!==a.key)return e;const s=new un(e.droppable.containers);return s.delete(t),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function xn(e){let{disabled:n}=e;const{active:t,activatorEvent:r,draggableNodes:a}=(0,g.useContext)(fn),s=I(r),i=I(null==t?void 0:t.id);return(0,g.useEffect)(()=>{if(!n&&!r&&s&&null!=i){if(!O(s))return;if(document.activeElement===s.target)return;const e=a.get(i);if(!e)return;const{activatorNode:n,node:t}=e;if(!n.current&&!t.current)return;requestAnimationFrame(()=>{for(const e of[n.current,t.current]){if(!e)continue;const n=W(e);if(n){n.focus();break}}})}},[r,n,a,i,s]),null}const bn=(0,g.createContext)({...Q,scaleX:1,scaleY:1});var yn;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(yn||(yn={}));const wn=(0,g.memo)(function(e){var n,t,r,a;let{id:s,accessibility:i,autoScroll:l=!0,children:o,sensors:c=on,collisionDetection:d=oe,measuring:u,modifiers:h,...v}=e;const f=(0,g.useReducer)(pn,void 0,gn),[m,_]=f,[y,j]=function(){const[e]=(0,g.useState)(()=>new Set),n=(0,g.useCallback)(n=>(e.add(n),()=>e.delete(n)),[e]);return[(0,g.useCallback)(n=>{let{type:t,event:r}=n;e.forEach(e=>{var n;return null==(n=e[t])?void 0:n.call(e,r)})},[e]),n]}(),[S,N]=(0,g.useState)(yn.Uninitialized),D=S===yn.Initialized,{draggable:{active:T,nodes:A,translate:L},droppable:{containers:O}}=m,z=null!=T?A.get(T):null,H=(0,g.useRef)({initial:null,translated:null}),W=(0,g.useMemo)(()=>{var e;return null!=T?{id:T,data:null!=(e=null==z?void 0:z.data)?e:cn,rect:H}:null},[T,z]),U=(0,g.useRef)(null),[X,V]=(0,g.useState)(null),[K,Y]=(0,g.useState)(null),Z=E(v,Object.values(v)),$=B("DndDescribedBy",s),ee=(0,g.useMemo)(()=>O.getEnabled(),[O]),ne=(te=u,(0,g.useMemo)(()=>({draggable:{...dn.draggable,...null==te?void 0:te.draggable},droppable:{...dn.droppable,...null==te?void 0:te.droppable},dragOverlay:{...dn.dragOverlay,...null==te?void 0:te.dragOverlay}}),[null==te?void 0:te.draggable,null==te?void 0:te.droppable,null==te?void 0:te.dragOverlay]));var te;const{droppableRects:re,measureDroppableContainers:se,measuringScheduled:ie}=function(e,n){let{dragging:t,dependencies:r,config:a}=n;const[s,i]=(0,g.useState)(null),{frequency:l,measure:o,strategy:c}=a,d=(0,g.useRef)(e),u=function(){switch(c){case Je.Always:return!1;case Je.BeforeDragging:return t;default:return!t}}(),h=E(u),v=(0,g.useCallback)(function(e){void 0===e&&(e=[]),h.current||i(n=>null===n?e:n.concat(e.filter(e=>!n.includes(e))))},[h]),f=(0,g.useRef)(null),m=k(n=>{if(u&&!t)return $e;if(!n||n===$e||d.current!==e||null!=s){const n=new Map;for(let t of e){if(!t)continue;if(s&&s.length>0&&!s.includes(t.id)&&t.rect.current){n.set(t.id,t.rect.current);continue}const e=t.node.current,r=e?new Ee(o(e),e):null;t.rect.current=r,r&&n.set(t.id,r)}return n}return n},[e,s,t,u,o]);return(0,g.useEffect)(()=>{d.current=e},[e]),(0,g.useEffect)(()=>{u||v()},[t,u]),(0,g.useEffect)(()=>{s&&s.length>0&&i(null)},[JSON.stringify(s)]),(0,g.useEffect)(()=>{u||"number"!=typeof l||null!==f.current||(f.current=setTimeout(()=>{v(),f.current=null},l))},[l,u,v,...r]),{droppableRects:m,measureDroppableContainers:v,measuringScheduled:null!=s}}(ee,{dragging:D,dependencies:[L.x,L.y],config:ne.droppable}),le=function(e,n){const t=null!=n?e.get(n):void 0,r=t?t.node.current:null;return k(e=>{var t;return null==n?null:null!=(t=null!=r?r:e)?t:null},[r,n])}(A,T),de=(0,g.useMemo)(()=>K?P(K):null,[K]),he=function(){const e=!1===(null==X?void 0:X.autoScrollEnabled),n="object"==typeof l?!1===l.enabled:!1===l,t=D&&!e&&!n;return"object"==typeof l?{...l,enabled:t}:{enabled:t}}(),fe=function(e,n){return Qe(e,n)}(le,ne.draggable.measure);!function(e){let{activeNode:n,measure:t,initialRect:r,config:a=!0}=e;const s=(0,g.useRef)(!1),{x:i,y:l}="boolean"==typeof a?{x:a,y:a}:a;R(()=>{if(!i&&!l||!n)return void(s.current=!1);if(s.current||!r)return;const e=null==n?void 0:n.node.current;if(!e||!1===e.isConnected)return;const a=ce(t(e),r);if(i||(a.x=0),l||(a.y=0),s.current=!0,Math.abs(a.x)>0||Math.abs(a.y)>0){const n=ge(e);n&&n.scrollBy({top:a.y,left:a.x})}},[n,i,l,r,t])}({activeNode:null!=T?A.get(T):null,config:he.layoutShiftCompensation,initialRect:fe,measure:ne.draggable.measure});const xe=tn(le,ne.draggable.measure,fe),be=tn(le?le.parentElement:null),je=(0,g.useRef)({activatorEvent:null,active:null,activeNode:le,collisionRect:null,collisions:null,droppableRects:re,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ce=O.getNodeFor(null==(n=je.current.over)?void 0:n.id),Ne=function(e){let{measure:n}=e;const[t,r]=(0,g.useState)(null),a=en({callback:(0,g.useCallback)(e=>{for(const{target:t}of e)if(C(t)){r(e=>{const r=n(t);return e?{...e,width:r.width,height:r.height}:r});break}},[n])}),s=(0,g.useCallback)(e=>{const t=function(e){if(!e)return null;if(e.children.length>1)return e;const n=e.children[0];return C(n)?n:e}(e);null==a||a.disconnect(),t&&(null==a||a.observe(t)),r(t?n(t):null)},[n,a]),[i,l]=M(s);return(0,g.useMemo)(()=>({nodeRef:i,rect:t,setRef:l}),[t,i,l])}({measure:ne.dragOverlay.measure}),De=null!=(t=Ne.nodeRef.current)?t:le,ke=D?null!=(r=Ne.rect)?r:xe:null,Me=Boolean(Ne.nodeRef.current&&Ne.rect),Ie=ce(Te=Me?null:xe,Qe(Te));var Te;const Be=sn(De?w(De):null),Ae=function(e){const n=(0,g.useRef)(e),t=k(t=>e?t&&t!==rn&&e&&n.current&&e.parentNode===n.current.parentNode?t:me(e):rn,[e]);return(0,g.useEffect)(()=>{n.current=e},[e]),t}(D?null!=Ce?Ce:le:null),Fe=function(e,n){void 0===n&&(n=ve);const[t]=e,r=sn(t?w(t):null),[a,s]=(0,g.useState)(ln);function i(){s(()=>e.length?e.map(e=>we(e)?r:new Ee(n(e),e)):ln)}const l=en({callback:i});return R(()=>{null==l||l.disconnect(),i(),e.forEach(e=>null==l?void 0:l.observe(e))},[e]),a}(Ae),Le=function(e,n){let{transform:t,...r}=n;return null!=e&&e.length?e.reduce((e,n)=>n({transform:e,...r}),t):t}(h,{transform:{x:L.x-Ie.x,y:L.y-Ie.y,scaleX:1,scaleY:1},activatorEvent:K,active:W,activeNodeRect:xe,containerNodeRect:be,draggingNodeRect:ke,over:je.current.over,overlayNodeRect:Ne.rect,scrollableAncestors:Ae,scrollableAncestorRects:Fe,windowRect:Be}),Oe=de?F(de,L):null,Pe=function(e){const[n,t]=(0,g.useState)(null),r=(0,g.useRef)(e),a=(0,g.useCallback)(e=>{const n=pe(e.target);n&&t(e=>e?(e.set(n,_e(n)),new Map(e)):null)},[]);return(0,g.useEffect)(()=>{const n=r.current;if(e!==n){s(n);const i=e.map(e=>{const n=pe(e);return n?(n.addEventListener("scroll",a,{passive:!0}),[n,_e(n)]):null}).filter(e=>null!=e);t(i.length?new Map(i):null),r.current=e}return()=>{s(e),s(n)};function s(e){e.forEach(e=>{const n=pe(e);null==n||n.removeEventListener("scroll",a)})}},[a,e]),(0,g.useMemo)(()=>e.length?n?Array.from(n.values()).reduce((e,n)=>F(e,n),Q):Re(e):Q,[e,n])}(Ae),ze=an(Pe),He=an(Pe,[xe]),We=F(Le,ze),Ue=ke?ue(ke,Le):null,Xe=W&&Ue?d({active:W,collisionRect:Ue,droppableRects:re,droppableContainers:ee,pointerCoordinates:Oe}):null,Ve=ae(Xe,"id"),[qe,Ze]=(0,g.useState)(null),nn=function(e,n,t){return{...e,scaleX:n&&t?n.width/t.width:1,scaleY:n&&t?n.height/t.height:1}}(Me?Le:F(Le,He),null!=(a=null==qe?void 0:qe.rect)?a:null,xe),un=(0,g.useRef)(null),hn=(0,g.useCallback)((e,n)=>{let{sensor:t,options:r}=n;if(null==U.current)return;const a=A.get(U.current);if(!a)return;const s=e.nativeEvent,i=new t({active:U.current,activeNode:a,event:s,options:r,context:je,onAbort(e){if(!A.get(e))return;const{onDragAbort:n}=Z.current,t={id:e};null==n||n(t),y({type:"onDragAbort",event:t})},onPending(e,n,t,r){if(!A.get(e))return;const{onDragPending:a}=Z.current,s={id:e,constraint:n,initialCoordinates:t,offset:r};null==a||a(s),y({type:"onDragPending",event:s})},onStart(e){const n=U.current;if(null==n)return;const t=A.get(n);if(!t)return;const{onDragStart:r}=Z.current,a={activatorEvent:s,active:{id:n,data:t.data,rect:H}};(0,x.unstable_batchedUpdates)(()=>{null==r||r(a),N(yn.Initializing),_({type:J.DragStart,initialCoordinates:e,active:n}),y({type:"onDragStart",event:a}),V(un.current),Y(s)})},onMove(e){_({type:J.DragMove,coordinates:e})},onEnd:l(J.DragEnd),onCancel:l(J.DragCancel)});function l(e){return async function(){const{active:n,collisions:t,over:r,scrollAdjustedTranslate:a}=je.current;let i=null;if(n&&a){const{cancelDrop:l}=Z.current;i={activatorEvent:s,active:n,collisions:t,delta:a,over:r},e===J.DragEnd&&"function"==typeof l&&await Promise.resolve(l(i))&&(e=J.DragCancel)}U.current=null,(0,x.unstable_batchedUpdates)(()=>{_({type:e}),N(yn.Uninitialized),Ze(null),V(null),Y(null),un.current=null;const n=e===J.DragEnd?"onDragEnd":"onDragCancel";if(i){const e=Z.current[n];null==e||e(i),y({type:n,event:i})}})}}un.current=i},[A]),vn=(0,g.useCallback)((e,n)=>(t,r)=>{const a=t.nativeEvent,s=A.get(r);if(null!==U.current||!s||a.dndKit||a.defaultPrevented)return;const i={active:s};!0===e(t,n.options,i)&&(a.dndKit={capturedBy:n.sensor},U.current=r,hn(t,n))},[A,hn]),wn=function(e,n){return(0,g.useMemo)(()=>e.reduce((e,t)=>{const{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:n(e.handler,t)}))]},[]),[e,n])}(c,vn);!function(e){(0,g.useEffect)(()=>{if(!b)return;const n=e.map(e=>{let{sensor:n}=e;return null==n.setup?void 0:n.setup()});return()=>{for(const e of n)null==e||e()}},e.map(e=>{let{sensor:n}=e;return n}))}(c),R(()=>{xe&&S===yn.Initializing&&N(yn.Initialized)},[xe,S]),(0,g.useEffect)(()=>{const{onDragMove:e}=Z.current,{active:n,activatorEvent:t,collisions:r,over:a}=je.current;if(!n||!t)return;const s={active:n,activatorEvent:t,collisions:r,delta:{x:We.x,y:We.y},over:a};(0,x.unstable_batchedUpdates)(()=>{null==e||e(s),y({type:"onDragMove",event:s})})},[We.x,We.y]),(0,g.useEffect)(()=>{const{active:e,activatorEvent:n,collisions:t,droppableContainers:r,scrollAdjustedTranslate:a}=je.current;if(!e||null==U.current||!n||!a)return;const{onDragOver:s}=Z.current,i=r.get(Ve),l=i&&i.rect.current?{id:i.id,rect:i.rect.current,data:i.data,disabled:i.disabled}:null,o={active:e,activatorEvent:n,collisions:t,delta:{x:a.x,y:a.y},over:l};(0,x.unstable_batchedUpdates)(()=>{Ze(l),null==s||s(o),y({type:"onDragOver",event:o})})},[Ve]),R(()=>{je.current={activatorEvent:K,active:W,activeNode:le,collisionRect:Ue,collisions:Xe,droppableRects:re,draggableNodes:A,draggingNode:De,draggingNodeRect:ke,droppableContainers:O,over:qe,scrollableAncestors:Ae,scrollAdjustedTranslate:We},H.current={initial:ke,translated:Ue}},[W,le,Xe,Ue,A,De,ke,re,O,qe,Ae,We]),function(e){let{acceleration:n,activator:t=Ke.Pointer,canScroll:r,draggingRect:a,enabled:s,interval:i=5,order:l=Ye.TreeOrder,pointerCoordinates:o,scrollableAncestors:c,scrollableAncestorRects:d,delta:u,threshold:h}=e;const v=function(e){let{delta:n,disabled:t}=e;const r=I(n);return k(e=>{if(t||!r||!e)return Ge;const a=Math.sign(n.x-r.x),s=Math.sign(n.y-r.y);return{x:{[ye.Backward]:e.x[ye.Backward]||-1===a,[ye.Forward]:e.x[ye.Forward]||1===a},y:{[ye.Backward]:e.y[ye.Backward]||-1===s,[ye.Forward]:e.y[ye.Forward]||1===s}}},[t,n,r])}({delta:u,disabled:!s}),[f,m]=function(){const e=(0,g.useRef)(null);return[(0,g.useCallback)((n,t)=>{e.current=setInterval(n,t)},[]),(0,g.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),p=(0,g.useRef)({x:0,y:0}),x=(0,g.useRef)({x:0,y:0}),b=(0,g.useMemo)(()=>{switch(t){case Ke.Pointer:return o?{top:o.y,bottom:o.y,left:o.x,right:o.x}:null;case Ke.DraggableRect:return a}},[t,a,o]),_=(0,g.useRef)(null),y=(0,g.useCallback)(()=>{const e=_.current;if(!e)return;const n=p.current.x*x.current.x,t=p.current.y*x.current.y;e.scrollBy(n,t)},[]),w=(0,g.useMemo)(()=>l===Ye.TreeOrder?[...c].reverse():c,[l,c]);(0,g.useEffect)(()=>{if(s&&c.length&&b){for(const e of w){if(!1===(null==r?void 0:r(e)))continue;const t=c.indexOf(e),a=d[t];if(!a)continue;const{direction:s,speed:l}=Se(e,a,b,n,h);for(const e of["x","y"])v[e][s[e]]||(l[e]=0,s[e]=0);if(l.x>0||l.y>0)return m(),_.current=e,f(y,i),p.current=l,void(x.current=s)}p.current={x:0,y:0},x.current={x:0,y:0},m()}else m()},[n,y,r,m,s,i,JSON.stringify(b),JSON.stringify(v),f,c,w,d,JSON.stringify(h)])}({...he,delta:L,draggingRect:Ue,pointerCoordinates:Oe,scrollableAncestors:Ae,scrollableAncestorRects:Fe});const jn=(0,g.useMemo)(()=>({active:W,activeNode:le,activeNodeRect:xe,activatorEvent:K,collisions:Xe,containerNodeRect:be,dragOverlay:Ne,draggableNodes:A,droppableContainers:O,droppableRects:re,over:qe,measureDroppableContainers:se,scrollableAncestors:Ae,scrollableAncestorRects:Fe,measuringConfiguration:ne,measuringScheduled:ie,windowRect:Be}),[W,le,xe,K,Xe,be,Ne,A,O,re,qe,se,Ae,Fe,ne,ie,Be]),Cn=(0,g.useMemo)(()=>({activatorEvent:K,activators:wn,active:W,activeNodeRect:xe,ariaDescribedById:{draggable:$},dispatch:_,draggableNodes:A,over:qe,measureDroppableContainers:se}),[K,wn,W,xe,_,$,A,qe,se]);return p().createElement(q.Provider,{value:j},p().createElement(fn.Provider,{value:Cn},p().createElement(mn.Provider,{value:jn},p().createElement(bn.Provider,{value:nn},o)),p().createElement(xn,{disabled:!1===(null==i?void 0:i.restoreFocus)})),p().createElement(G,{...i,hiddenTextDescribedById:$}))}),jn=(0,g.createContext)(null),Cn="button";const Sn={timeout:25};function Nn(e,n,t){const r=e.slice();return r.splice(t<0?r.length+t:t,0,r.splice(n,1)[0]),r}function Rn(e,n){return e.reduce((e,t,r)=>{const a=n.get(t);return a&&(e[r]=a),e},Array(e.length))}function Dn(e){return null!==e&&e>=0}const En=e=>{let{rects:n,activeIndex:t,overIndex:r,index:a}=e;const s=Nn(n,r,t),i=n[a],l=s[a];return l&&i?{x:l.left-i.left,y:l.top-i.top,scaleX:l.width/i.width,scaleY:l.height/i.height}:null},kn={scaleX:1,scaleY:1},Mn=e=>{var n;let{activeIndex:t,activeNodeRect:r,index:a,rects:s,overIndex:i}=e;const l=null!=(n=s[t])?n:r;if(!l)return null;if(a===t){const e=s[i];return e?{x:0,y:t<i?e.top+e.height-(l.top+l.height):e.top-l.top,...kn}:null}const o=function(e,n,t){const r=e[n],a=e[n-1],s=e[n+1];return r?t<n?a?r.top-(a.top+a.height):s?s.top-(r.top+r.height):0:s?s.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}(s,a,t);return a>t&&a<=i?{x:0,y:-l.height-o,...kn}:a<t&&a>=i?{x:0,y:l.height+o,...kn}:{x:0,y:0,...kn}},In="Sortable",Tn=p().createContext({activeIndex:-1,containerId:In,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:En,disabled:{draggable:!1,droppable:!1}});function Bn(e){let{children:n,id:t,items:r,strategy:a=En,disabled:s=!1}=e;const{active:i,dragOverlay:l,droppableRects:o,over:c,measureDroppableContainers:d}=(0,g.useContext)(mn),u=B(In,t),h=Boolean(null!==l.rect),v=(0,g.useMemo)(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),f=null!=i,m=i?v.indexOf(i.id):-1,x=c?v.indexOf(c.id):-1,b=(0,g.useRef)(v),_=!function(e,n){if(e===n)return!0;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}(v,b.current),y=-1!==x&&-1===m||_,w=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(s);R(()=>{_&&f&&d(v)},[_,v,f,d]),(0,g.useEffect)(()=>{b.current=v},[v]);const j=(0,g.useMemo)(()=>({activeIndex:m,containerId:u,disabled:w,disableTransforms:y,items:v,overIndex:x,useDragOverlay:h,sortedRects:Rn(v,o),strategy:a}),[m,u,w.draggable,w.droppable,y,v,x,o,h,a]);return p().createElement(Tn.Provider,{value:j},n)}const An=e=>{let{id:n,items:t,activeIndex:r,overIndex:a}=e;return Nn(t,r,a).indexOf(n)},Fn=e=>{let{containerId:n,isSorting:t,wasDragging:r,index:a,items:s,newIndex:i,previousItems:l,previousContainerId:o,transition:c}=e;return!(!c||!r||l!==s&&a===i||!t&&(i===a||n!==o))},Ln={duration:200,easing:"ease"},On="transform",Pn=z.Transition.toString({property:On,duration:0,easing:"linear"}),zn={roleDescription:"sortable"};function Hn(e){let{animateLayoutChanges:n=Fn,attributes:t,disabled:r,data:a,getNewIndex:s=An,id:i,strategy:l,resizeObserverConfig:o,transition:c=Ln}=e;const{items:d,containerId:u,activeIndex:h,disabled:v,disableTransforms:f,sortedRects:m,overIndex:p,useDragOverlay:x,strategy:b}=(0,g.useContext)(Tn),_=function(e,n){var t,r;return"boolean"==typeof e?{draggable:e,droppable:!1}:{draggable:null!=(t=null==e?void 0:e.draggable)?t:n.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:n.droppable}}(r,v),y=d.indexOf(i),w=(0,g.useMemo)(()=>({sortable:{containerId:u,index:y,items:d},...a}),[u,a,y,d]),j=(0,g.useMemo)(()=>d.slice(d.indexOf(i)),[d,i]),{rect:C,node:S,isOver:N,setNodeRef:D}=function(e){let{data:n,disabled:t=!1,id:r,resizeObserverConfig:a}=e;const s=B("Droppable"),{active:i,dispatch:l,over:o,measureDroppableContainers:c}=(0,g.useContext)(fn),d=(0,g.useRef)({disabled:t}),u=(0,g.useRef)(!1),h=(0,g.useRef)(null),v=(0,g.useRef)(null),{disabled:f,updateMeasurementsFor:m,timeout:p}={...Sn,...a},x=E(null!=m?m:r),b=en({callback:(0,g.useCallback)(()=>{u.current?(null!=v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{c(Array.isArray(x.current)?x.current:[x.current]),v.current=null},p)):u.current=!0},[p]),disabled:f||!i}),_=(0,g.useCallback)((e,n)=>{b&&(n&&(b.unobserve(n),u.current=!1),e&&b.observe(e))},[b]),[y,w]=M(_),j=E(n);return(0,g.useEffect)(()=>{b&&y.current&&(b.disconnect(),u.current=!1,b.observe(y.current))},[y,b]),(0,g.useEffect)(()=>(l({type:J.RegisterDroppable,element:{id:r,key:s,disabled:t,node:y,rect:h,data:j}}),()=>l({type:J.UnregisterDroppable,key:s,id:r})),[r]),(0,g.useEffect)(()=>{t!==d.current.disabled&&(l({type:J.SetDroppableDisabled,id:r,key:s,disabled:t}),d.current.disabled=t)},[r,s,t,l]),{active:i,rect:h,isOver:(null==o?void 0:o.id)===r,node:y,over:o,setNodeRef:w}}({id:i,data:w,disabled:_.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...o}}),{active:k,activatorEvent:I,activeNodeRect:T,attributes:A,setNodeRef:F,listeners:L,isDragging:P,over:H,setActivatorNodeRef:W,transform:U}=function(e){let{id:n,data:t,disabled:r=!1,attributes:a}=e;const s=B("Draggable"),{activators:i,activatorEvent:l,active:o,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:h}=(0,g.useContext)(fn),{role:v=Cn,roleDescription:f="draggable",tabIndex:m=0}=null!=a?a:{},p=(null==o?void 0:o.id)===n,x=(0,g.useContext)(p?bn:jn),[b,_]=M(),[y,w]=M(),j=function(e,n){return(0,g.useMemo)(()=>e.reduce((e,t)=>{let{eventName:r,handler:a}=t;return e[r]=e=>{a(e,n)},e},{}),[e,n])}(i,n),C=E(t);return R(()=>(u.set(n,{id:n,key:s,node:b,activatorNode:y,data:C}),()=>{const e=u.get(n);e&&e.key===s&&u.delete(n)}),[u,n]),{active:o,activatorEvent:l,activeNodeRect:c,attributes:(0,g.useMemo)(()=>({role:v,tabIndex:m,"aria-disabled":r,"aria-pressed":!(!p||v!==Cn)||void 0,"aria-roledescription":f,"aria-describedby":d.draggable}),[r,v,m,p,f,d.draggable]),isDragging:p,listeners:r?void 0:j,node:b,over:h,setNodeRef:_,setActivatorNodeRef:w,transform:x}}({id:i,data:w,attributes:{...zn,...t},disabled:_.draggable}),X=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,g.useMemo)(()=>e=>{n.forEach(n=>n(e))},n)}(D,F),V=Boolean(k),q=V&&!f&&Dn(h)&&Dn(p),K=!x&&P,Y=K&&q?U:null,G=q?null!=Y?Y:(null!=l?l:b)({rects:m,activeNodeRect:T,activeIndex:h,overIndex:p,index:y}):null,Z=Dn(h)&&Dn(p)?s({id:i,items:d,activeIndex:h,overIndex:p}):y,$=null==k?void 0:k.id,Q=(0,g.useRef)({activeId:$,items:d,newIndex:Z,containerId:u}),ee=d!==Q.current.items,ne=n({active:k,containerId:u,isDragging:P,isSorting:V,id:i,index:y,items:d,newIndex:Q.current.newIndex,previousItems:Q.current.items,previousContainerId:Q.current.containerId,transition:c,wasDragging:null!=Q.current.activeId}),te=function(e){let{disabled:n,index:t,node:r,rect:a}=e;const[s,i]=(0,g.useState)(null),l=(0,g.useRef)(t);return R(()=>{if(!n&&t!==l.current&&r.current){const e=a.current;if(e){const n=ve(r.current,{ignoreTransform:!0}),t={x:e.left-n.left,y:e.top-n.top,scaleX:e.width/n.width,scaleY:e.height/n.height};(t.x||t.y)&&i(t)}}t!==l.current&&(l.current=t)},[n,t,r,a]),(0,g.useEffect)(()=>{s&&i(null)},[s]),s}({disabled:!ne,index:y,node:S,rect:C});return(0,g.useEffect)(()=>{V&&Q.current.newIndex!==Z&&(Q.current.newIndex=Z),u!==Q.current.containerId&&(Q.current.containerId=u),d!==Q.current.items&&(Q.current.items=d)},[V,Z,u,d]),(0,g.useEffect)(()=>{if($===Q.current.activeId)return;if(null!=$&&null==Q.current.activeId)return void(Q.current.activeId=$);const e=setTimeout(()=>{Q.current.activeId=$},50);return()=>clearTimeout(e)},[$]),{active:k,activeIndex:h,attributes:A,data:w,rect:C,index:y,newIndex:Z,items:d,isOver:N,isSorting:V,isDragging:P,listeners:L,node:S,overIndex:p,over:H,setNodeRef:X,setActivatorNodeRef:W,setDroppableNodeRef:D,setDraggableNodeRef:F,transform:null!=te?te:G,transition:te||ee&&Q.current.newIndex===y?Pn:K&&!O(I)||!c?void 0:V||ne?z.Transition.toString({...c,property:On}):void 0}}function Wn(e){if(!e)return!1;const n=e.data.current;return!!(n&&"sortable"in n&&"object"==typeof n.sortable&&"containerId"in n.sortable&&"items"in n.sortable&&"index"in n.sortable)}const Un=[Te.Down,Te.Right,Te.Up,Te.Left],Xn=(e,n)=>{let{context:{active:t,collisionRect:r,droppableRects:a,droppableContainers:s,over:i,scrollableAncestors:l}}=n;if(Un.includes(e.code)){if(e.preventDefault(),!t||!r)return;const n=[];s.getEnabled().forEach(t=>{if(!t||null!=t&&t.disabled)return;const s=a.get(t.id);if(s)switch(e.code){case Te.Down:r.top<s.top&&n.push(t);break;case Te.Up:r.top>s.top&&n.push(t);break;case Te.Left:r.left>s.left&&n.push(t);break;case Te.Right:r.left<s.left&&n.push(t)}});const d=(e=>{let{collisionRect:n,droppableRects:t,droppableContainers:r}=e;const a=re(n),s=[];for(const e of r){const{id:n}=e,r=t.get(n);if(r){const t=re(r),i=a.reduce((e,n,r)=>e+ee(t[r],n),0),l=Number((i/4).toFixed(4));s.push({id:n,data:{droppableContainer:e,value:l}})}}return s.sort(ne)})({active:t,collisionRect:r,droppableRects:a,droppableContainers:n,pointerCoordinates:null});let u=ae(d,"id");if(u===(null==i?void 0:i.id)&&d.length>1&&(u=d[1].id),null!=u){const e=s.get(t.id),n=s.get(u),i=n?a.get(n.id):null,d=null==n?void 0:n.node.current;if(d&&i&&e&&n){const t=me(d).some((e,n)=>l[n]!==e),a=Vn(e,n),s=(c=n,!(!Wn(o=e)||!Wn(c))&&!!Vn(o,c)&&o.data.current.sortable.index<c.data.current.sortable.index),u=t||!a?{x:0,y:0}:{x:s?r.width-i.width:0,y:s?r.height-i.height:0},h={x:i.left,y:i.top};return u.x&&u.y?h:L(h,u)}}}var o,c};function Vn(e,n){return!(!Wn(e)||!Wn(n))&&e.data.current.sortable.containerId===n.data.current.sortable.containerId}function qn(e){const n={type:e.value};switch(e.inputType){case"select":n.value=e.options?.[0]?.value||"";break;case"dimensions":n.dimension="width",n.operator="gt",n.value=1920;break;case"filesize":n.operator="gt",n.value=1024;break;case"daterange":n.operator="after",n.value="";break;default:n.value=""}return n}function Kn({condition:e,index:n,onChange:r,onRemove:a,users:s}){const{conditionTypes:i=[]}=window.vmfaRulesEngine||{},l=i.find(n=>n.value===e.type),d=(t,a)=>{r(n,{...e,[t]:a})};return(0,c.jsxs)("div",{className:"vmfa-condition-row",children:[(0,c.jsxs)(o.Flex,{gap:3,align:"flex-start",children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:e.type,options:[{value:"",label:(0,t.__)("Select condition…","vmfa-rules-engine")},...i.map(e=>({value:e.value,label:e.label}))],onChange:e=>{const t=i.find(n=>n.value===e);t&&r(n,qn(t))},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexBlock,{children:(()=>{if(!l)return null;switch(l.inputType){case"text":return(0,c.jsx)(o.TextControl,{value:e.value||"",onChange:e=>d("value",e),placeholder:l.placeholder||"",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0});case"select":return(0,c.jsx)(o.SelectControl,{value:e.value||"",options:l.options||[],onChange:e=>d("value",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0});case"dimensions":return(0,c.jsxs)(o.Flex,{gap:2,wrap:!0,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:e.dimension||"width",options:[{value:"width",label:(0,t.__)("Width","vmfa-rules-engine")},{value:"height",label:(0,t.__)("Height","vmfa-rules-engine")},{value:"both",label:(0,t.__)("Both","vmfa-rules-engine")}],onChange:e=>d("dimension",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:e.operator||"gt",options:[{value:"gt",label:">"},{value:"gte",label:">="},{value:"lt",label:"<"},{value:"lte",label:"<="},{value:"eq",label:"="},{value:"between",label:(0,t.__)("Between","vmfa-rules-engine")}],onChange:e=>d("operator",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"number",value:e.value||"",onChange:e=>d("value",parseInt(e,10)||0),placeholder:"1920",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),"between"===e.operator&&(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"number",value:e.value_end||"",onChange:e=>d("value_end",parseInt(e,10)||0),placeholder:"3840",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)("span",{className:"vmfa-condition-unit",children:"px"})})]});case"filesize":return(0,c.jsxs)(o.Flex,{gap:2,wrap:!0,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:e.operator||"gt",options:[{value:"gt",label:">"},{value:"gte",label:">="},{value:"lt",label:"<"},{value:"lte",label:"<="},{value:"between",label:(0,t.__)("Between","vmfa-rules-engine")}],onChange:e=>d("operator",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"number",value:e.value||"",onChange:e=>d("value",parseInt(e,10)||0),placeholder:"1024",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),"between"===e.operator&&(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"number",value:e.value_end||"",onChange:e=>d("value_end",parseInt(e,10)||0),placeholder:"5120",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)("span",{className:"vmfa-condition-unit",children:"KB"})})]});case"daterange":return(0,c.jsxs)(o.Flex,{gap:2,wrap:!0,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:e.operator||"after",options:[{value:"after",label:(0,t.__)("After","vmfa-rules-engine")},{value:"before",label:(0,t.__)("Before","vmfa-rules-engine")},{value:"on",label:(0,t.__)("On","vmfa-rules-engine")},{value:"between",label:(0,t.__)("Between","vmfa-rules-engine")},{value:"year",label:(0,t.__)("In year","vmfa-rules-engine")},{value:"month",label:(0,t.__)("In month","vmfa-rules-engine")}],onChange:e=>d("operator",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"date",value:e.value||"",onChange:e=>d("value",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),"between"===e.operator&&(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.TextControl,{type:"date",value:e.value_end||"",onChange:e=>d("value_end",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})})]});case"user":return(0,c.jsx)(o.SelectControl,{value:String(e.value||""),options:[{value:"",label:(0,t.__)("Select a user…","vmfa-rules-engine")},...s.map(e=>({value:String(e.id),label:`${e.display_name} (${e.user_login})`}))],onChange:e=>d("value",parseInt(e,10)||0),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0});default:return(0,c.jsx)(o.TextControl,{value:e.value||"",onChange:e=>d("value",e),__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}})()}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{icon:f,label:(0,t.__)("Remove condition","vmfa-rules-engine"),isDestructive:!0,onClick:()=>a(n)})})]}),l?.description&&(0,c.jsx)("p",{className:"vmfa-condition-description",children:l.description})]})}function Yn({conditions:e,onChange:r}){const{users:s}=function(){const[e,t]=(0,n.useState)([]),[r,s]=(0,n.useState)(!0),{nonce:i}=window.vmfaRulesEngine||{};return(0,n.useEffect)(()=>{(async()=>{try{const e=await a()({path:"vmfa-rules/v1/users",headers:{"X-WP-Nonce":i}});t(e)}catch(e){}finally{s(!1)}})()},[i]),{users:e,isLoading:r}}(),{conditionTypes:i=[]}=window.vmfaRulesEngine||{},l=(0,n.useCallback)(()=>{const n=i[0];n&&r([...e,qn(n)])},[e,i,r]),d=(0,n.useCallback)((n,t)=>{const a=[...e];a[n]=t,r(a)},[e,r]),u=(0,n.useCallback)(n=>{const t=e.filter((e,t)=>t!==n);r(t)},[e,r]);return(0,c.jsxs)("div",{className:"vmfa-condition-builder",children:[e.length>0?(0,c.jsx)("div",{className:"vmfa-condition-list",children:e.map((e,n)=>(0,c.jsx)(Kn,{condition:e,index:n,onChange:d,onRemove:u,users:s},n))}):(0,c.jsx)("p",{className:"vmfa-condition-empty",children:(0,t.__)("No conditions added yet. Add at least one condition.","vmfa-rules-engine")}),(0,c.jsx)(o.Button,{variant:"secondary",icon:m,onClick:l,className:"vmfa-condition-add",children:(0,t.__)("Add Condition","vmfa-rules-engine")})]})}function Gn({rule:e,folders:r,onSave:s,onCancel:i,isSaving:l,onFoldersChange:d}){const[u,h]=(0,n.useState)(""),[v,f]=(0,n.useState)(""),[g,p]=(0,n.useState)([]),[x,b]=(0,n.useState)(!0),[_,y]=(0,n.useState)(!0),[w,j]=(0,n.useState)({}),[C,S]=(0,n.useState)(!1),[N,R]=(0,n.useState)(""),[D,E]=(0,n.useState)(0),[k,M]=(0,n.useState)(!1),[I,T]=(0,n.useState)(""),B=(0,n.useRef)(null),A=(0,n.useRef)(!0);(0,n.useEffect)(()=>(A.current=!0,()=>{A.current=!1}),[]);const{strings:F={}}=window.vmfaRulesEngine||{};(0,n.useEffect)(()=>{B.current&&r.some(e=>String(e.id)===B.current)&&(f(B.current),B.current=null)},[r]);const L=(0,n.useRef)(!1);(0,n.useEffect)(()=>{var n,t;L.current||(e?(h(e.name||""),f(String(e.folder_id||"")),p(e.conditions||[]),b(null===(n=e.stop_processing)||void 0===n||n),y(null===(t=e.enabled)||void 0===t||t)):(h(""),f(r.length>0?String(r[0].id):""),p([]),b(!0),y(!0)),L.current=!0)},[e,r]);const O=(0,n.useCallback)(()=>{const e={};return u.trim()||(e.name=(0,t.__)("Rule name is required.","vmfa-rules-engine")),v||(e.folder=(0,t.__)("Target folder is required.","vmfa-rules-engine")),0===g.length&&(e.conditions=(0,t.__)("At least one condition is required.","vmfa-rules-engine")),j(e),0===Object.keys(e).length},[u,v,g]),P=(0,n.useCallback)(()=>{O()&&s({name:u,folder_id:parseInt(v,10),conditions:g,stop_processing:x,enabled:_})},[u,v,g,x,_,O,s]),z=(0,n.useCallback)(()=>{const e=(n,t=0,r=0)=>{const a=[],s=n.filter(e=>e.parent===t);for(const t of s)a.push({value:String(t.id),label:"—".repeat(r)+(r>0?" ":"")+t.name}),a.push(...e(n,t.id,r+1));return a};return[{value:"",label:(0,t.__)("Select a folder…","vmfa-rules-engine")},...e(r)]},[r]),H=(0,n.useCallback)(()=>{const e=(n,t=0,r=0)=>{const a=[],s=n.filter(e=>e.parent===t);for(const t of s)a.push({value:String(t.id),label:"—".repeat(r)+(r>0?" ":"")+t.name}),a.push(...e(n,t.id,r+1));return a};return[{value:"0",label:(0,t.__)("None (top level)","vmfa-rules-engine")},...e(r)]},[r]),W=(0,n.useCallback)(async()=>{if(!k)if(N.trim()){M(!0),T("");try{const e=await a()({path:"/vmfo/v1/folders",method:"POST",data:{name:N.trim(),parent:D}});if(!A.current)return;R(""),E(0),S(!1);const n=e?.id?String(e.id):null;if(d){const e=await d();if(!A.current)return;n&&Array.isArray(e)&&e.some(e=>String(e.id)===n)?f(n):n&&(B.current=n,f(n))}else n&&f(n)}catch(e){T(e.message||(0,t.__)("Failed to create folder.","vmfa-rules-engine"))}finally{A.current&&M(!1)}}else T((0,t.__)("Please enter a folder name.","vmfa-rules-engine"))},[N,D,d,k]);return(0,c.jsxs)(o.Modal,{title:e?F.editRule||(0,t.__)("Edit Rule","vmfa-rules-engine"):F.addRule||(0,t.__)("Add Rule","vmfa-rules-engine"),onRequestClose:i,className:"vmfa-rule-editor-modal",shouldCloseOnClickOutside:!1,children:[(0,c.jsxs)("div",{className:"vmfa-rule-editor",children:[(0,c.jsx)(o.TextControl,{label:F.ruleName||(0,t.__)("Rule Name","vmfa-rules-engine"),value:u,onChange:h,placeholder:(0,t.__)("e.g., Mobile Photos","vmfa-rules-engine"),className:w.name?"has-error":"",__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),w.name&&(0,c.jsx)("p",{className:"vmfa-error-message",children:w.name}),(0,c.jsxs)("div",{className:"vmfa-rule-editor__folder-select",children:[(0,c.jsx)("label",{className:"vmfa-rule-editor__folder-label",children:F.targetFolder||(0,t.__)("Target Folder","vmfa-rules-engine")}),(0,c.jsxs)(o.Flex,{align:"flex-end",gap:2,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.SelectControl,{value:v,options:z(),onChange:f,className:w.folder?"has-error":"",hideLabelFromVision:!0,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{icon:m,label:(0,t.__)("Create Folder","vmfa-rules-engine"),onClick:()=>{T(""),R(""),E(0),S(!0)},className:"vmfa-add-folder-button",size:"default"})})]}),w.folder&&(0,c.jsx)("p",{className:"vmfa-error-message",children:w.folder})]}),(0,c.jsxs)("div",{className:"vmfa-rule-editor__conditions",children:[(0,c.jsx)("h3",{children:F.conditions||(0,t.__)("Conditions","vmfa-rules-engine")}),(0,c.jsx)("p",{className:"description",children:(0,t.__)("All conditions must match (AND logic).","vmfa-rules-engine")}),w.conditions&&(0,c.jsx)("p",{className:"vmfa-error-message",children:w.conditions}),(0,c.jsx)(Yn,{conditions:g,onChange:p})]}),(0,c.jsxs)("div",{className:"vmfa-rule-editor__options",children:[(0,c.jsx)(o.ToggleControl,{label:F.stopProcessing||(0,t.__)("Stop processing after match","vmfa-rules-engine"),help:(0,t.__)("When enabled, no further rules will be evaluated after this rule matches.","vmfa-rules-engine"),checked:x,onChange:b,__nextHasNoMarginBottom:!0}),(0,c.jsx)(o.ToggleControl,{label:F.enabled||(0,t.__)("Enabled","vmfa-rules-engine"),help:(0,t.__)("Disabled rules will not be evaluated during uploads.","vmfa-rules-engine"),checked:_,onChange:y,__nextHasNoMarginBottom:!0})]}),(0,c.jsxs)(o.Flex,{justify:"flex-end",className:"vmfa-rule-editor__actions",children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"tertiary",onClick:i,disabled:l,children:(0,t.__)("Cancel","vmfa-rules-engine")})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"primary",onClick:P,disabled:l,children:l?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Spinner,{}),(0,t.__)("Saving…","vmfa-rules-engine")]}):(0,t.__)("Save Rule","vmfa-rules-engine")})})]})]}),C&&(0,c.jsxs)(o.Modal,{title:(0,t.__)("Create Folder","vmfa-rules-engine"),onRequestClose:()=>S(!1),className:"vmfa-create-folder-modal",overlayClassName:"vmfa-create-folder-modal-overlay",children:[(0,c.jsx)(o.TextControl,{label:(0,t.__)("Folder Name","vmfa-rules-engine"),value:N,onChange:R,placeholder:(0,t.__)("Enter folder name","vmfa-rules-engine"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,c.jsx)(o.SelectControl,{label:(0,t.__)("Parent Folder","vmfa-rules-engine"),value:String(D),options:H(),onChange:e=>E(parseInt(e,10)),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),I&&(0,c.jsx)("p",{className:"vmfa-create-folder-error",children:I}),(0,c.jsxs)(o.Flex,{justify:"flex-end",className:"vmfa-create-folder-actions",children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"secondary",onClick:()=>S(!1),disabled:k,children:(0,t.__)("Cancel","vmfa-rules-engine")})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"primary",onClick:W,disabled:k,children:k?(0,t.__)("Creating…","vmfa-rules-engine"):(0,t.__)("Create","vmfa-rules-engine")})})]})]})]})}var Jn=(0,c.jsx)(u.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,c.jsx)(u.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})});function Zn({results:e,onApply:r,onClose:a,onLoadMore:s,isProcessing:i,isLoadingMore:l}){const[d,u]=(0,n.useState)(new Set),[h,v]=(0,n.useState)(!1),[f,m]=(0,n.useState)(!1),[g,p]=(0,n.useState)(0),x=(0,n.useRef)(null),{strings:b={}}=window.vmfaRulesEngine||{},_=(0,n.useMemo)(()=>e?.items?e.items.filter(e=>"will_assign"===e.status):[],[e]),y=(0,n.useMemo)(()=>e?.items?e.items.filter(e=>"no_match"===e.status):[],[e]);(0,n.useEffect)(()=>{const n=x.current;if(!n||!e?.has_more||l)return;const t=()=>{const{scrollTop:e,scrollHeight:t,clientHeight:r}=n;t-e-r<100&&s?.()};return n.addEventListener("scroll",t),()=>n.removeEventListener("scroll",t)},[e?.has_more,l,s]),(0,n.useEffect)(()=>{if(!e?.has_more||l)return;if(_.length>0)return;if(g>=20)return;if(e.total>=5e3)return;p(e=>e+1);const n=window.setTimeout(()=>{s?.()},250);return()=>window.clearTimeout(n)},[e?.has_more,e?.total,_.length,l,g,s]);const w=(0,n.useCallback)(e=>{u(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},[]),j=(0,n.useCallback)(e=>{v(e),u(e?new Set(_.map(e=>e.attachment_id)):new Set)},[_]),C=(0,n.useCallback)(async()=>{0!==d.size&&(await r(Array.from(d)),m(!0))},[d,r]);return e?f&&void 0!==e.assigned?(0,c.jsx)(o.Modal,{title:(0,t.__)("Rules Applied","vmfa-rules-engine"),onRequestClose:a,className:"vmfa-preview-modal",children:(0,c.jsxs)("div",{className:"vmfa-preview-applied",children:[(0,c.jsxs)("div",{className:"vmfa-preview-stats",children:[(0,c.jsxs)("div",{className:"vmfa-preview-stat vmfa-preview-stat--success",children:[(0,c.jsx)("span",{className:"vmfa-preview-stat-value",children:e.assigned}),(0,c.jsx)("span",{className:"vmfa-preview-stat-label",children:(0,t.__)("Assigned","vmfa-rules-engine")})]}),(0,c.jsxs)("div",{className:"vmfa-preview-stat",children:[(0,c.jsx)("span",{className:"vmfa-preview-stat-value",children:e.skipped}),(0,c.jsx)("span",{className:"vmfa-preview-stat-label",children:(0,t.__)("Skipped","vmfa-rules-engine")})]}),e.errors>0&&(0,c.jsxs)("div",{className:"vmfa-preview-stat vmfa-preview-stat--error",children:[(0,c.jsx)("span",{className:"vmfa-preview-stat-value",children:e.errors}),(0,c.jsx)("span",{className:"vmfa-preview-stat-label",children:(0,t.__)("Errors","vmfa-rules-engine")})]})]}),(0,c.jsx)(o.Button,{variant:"primary",onClick:a,children:(0,t.__)("Close","vmfa-rules-engine")})]})}):(0,c.jsx)(o.Modal,{title:b.preview||(0,t.__)("Preview","vmfa-rules-engine"),onRequestClose:a,className:"vmfa-preview-modal",shouldCloseOnClickOutside:!1,children:(0,c.jsxs)("div",{className:"vmfa-preview-content",children:[(0,c.jsx)("div",{className:"vmfa-preview-summary",children:(0,c.jsxs)("p",{children:[(0,t.__)("Scanned","vmfa-rules-engine")," ",(0,c.jsx)("strong",{children:e.total}),e.total_count>e.total&&(0,c.jsxs)(c.Fragment,{children:[" ",(0,t.__)("of","vmfa-rules-engine")," ",(0,c.jsx)("strong",{children:e.total_count})]})," ",(0,t.__)("media items.","vmfa-rules-engine")," ",(0,c.jsx)("strong",{children:e.matched})," ",(0,t.__)("will be assigned to folders.","vmfa-rules-engine"),e.has_more&&_.length>0&&(0,c.jsxs)("span",{className:"vmfa-preview-loading-hint",children:[" ",(0,t.__)("Scroll down to load more.","vmfa-rules-engine")]})]})}),_.length>0&&(0,c.jsxs)("div",{className:"vmfa-preview-section",children:[(0,c.jsxs)("div",{className:"vmfa-preview-section-header",children:[(0,c.jsx)("h3",{children:(0,t.__)("Will be assigned","vmfa-rules-engine")}),(0,c.jsx)(o.CheckboxControl,{label:(0,t.__)("Select all loaded","vmfa-rules-engine"),checked:h,onChange:j,__nextHasNoMarginBottom:!0})]}),(0,c.jsxs)("div",{className:"vmfa-preview-table",ref:x,children:[(0,c.jsxs)("table",{children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{className:"vmfa-preview-col-check"}),(0,c.jsx)("th",{className:"vmfa-preview-col-thumb"}),(0,c.jsx)("th",{children:(0,t.__)("File","vmfa-rules-engine")}),(0,c.jsx)("th",{children:(0,t.__)("Rule","vmfa-rules-engine")}),(0,c.jsx)("th",{children:(0,t.__)("Folder","vmfa-rules-engine")})]})}),(0,c.jsx)("tbody",{children:_.map(e=>(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{className:"vmfa-preview-col-check",children:(0,c.jsx)(o.CheckboxControl,{checked:d.has(e.attachment_id),onChange:()=>w(e.attachment_id),__nextHasNoMarginBottom:!0})}),(0,c.jsx)("td",{className:"vmfa-preview-col-thumb",children:e.thumbnail&&(0,c.jsx)("img",{src:e.thumbnail,alt:"",width:"40",height:"40"})}),(0,c.jsx)("td",{children:(0,c.jsxs)("div",{className:"vmfa-preview-file",children:[(0,c.jsx)("span",{className:"vmfa-preview-filename",children:e.filename}),(0,c.jsx)("span",{className:"vmfa-preview-title",children:e.title})]})}),(0,c.jsx)("td",{children:e.matched_rule?.name}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"vmfa-preview-folder",children:e.target_folder?.name})})]},e.attachment_id))})]}),l&&(0,c.jsxs)("div",{className:"vmfa-preview-loading-more",children:[(0,c.jsx)(o.Spinner,{}),(0,c.jsx)("span",{children:(0,t.__)("Loading more…","vmfa-rules-engine")})]}),e.has_more&&!l&&(0,c.jsx)("div",{className:"vmfa-preview-load-more",children:(0,c.jsx)(o.Button,{variant:"secondary",icon:Jn,onClick:s,children:(0,t.__)("Load more","vmfa-rules-engine")})})]})]}),y.length>0&&(0,c.jsxs)("details",{className:"vmfa-preview-section vmfa-preview-section--collapsed",children:[(0,c.jsxs)("summary",{children:[(0,t.__)("No matching rules","vmfa-rules-engine")," (",y.length,")"]}),(0,c.jsxs)("div",{className:"vmfa-preview-unmatched",children:[y.slice(0,20).map(e=>(0,c.jsxs)("div",{className:"vmfa-preview-unmatched-item",children:[e.thumbnail&&(0,c.jsx)("img",{src:e.thumbnail,alt:"",width:"30",height:"30"}),(0,c.jsx)("span",{children:e.filename})]},e.attachment_id)),y.length>20&&(0,c.jsxs)("p",{className:"vmfa-preview-more",children:[(0,t.__)("And","vmfa-rules-engine")," ",y.length-20," ",(0,t.__)("more…","vmfa-rules-engine")]})]})]}),e.has_more&&0===_.length&&(0,c.jsx)("div",{className:"vmfa-preview-load-more",children:(0,c.jsx)(o.Button,{variant:"secondary",icon:Jn,onClick:()=>s?.(),disabled:l,children:l?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Spinner,{}),(0,t.__)("Loading more…","vmfa-rules-engine")]}):(0,t.__)("Load more","vmfa-rules-engine")})}),(0,c.jsxs)(o.Flex,{justify:"flex-end",className:"vmfa-preview-actions",children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"tertiary",onClick:a,disabled:i,children:(0,t.__)("Cancel","vmfa-rules-engine")})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"primary",onClick:C,disabled:0===d.size||i,children:i?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Spinner,{}),(0,t.__)("Applying…","vmfa-rules-engine")]}):(0,c.jsxs)(c.Fragment,{children:[b.apply||(0,t.__)("Apply Changes","vmfa-rules-engine"),d.size>0&&` (${d.size})`]})})})]})]})}):(0,c.jsx)(o.Modal,{title:b.preview||(0,t.__)("Preview","vmfa-rules-engine"),onRequestClose:a,className:"vmfa-preview-modal",children:(0,c.jsxs)("div",{className:"vmfa-preview-loading",children:[(0,c.jsx)(o.Spinner,{}),(0,c.jsx)("p",{children:(0,t.__)("Loading preview…","vmfa-rules-engine")})]})})}function $n({rule:e,onEdit:n,onDelete:r,onToggle:a,onScan:s,folders:i}){const{attributes:l,listeners:d,setNodeRef:u,transform:m,transition:g,isDragging:p}=Hn({id:e.id}),x={transform:z.Transform.toString(m),transition:g,opacity:p?.5:1},b=i.find(n=>n.id===e.folder_id),_=b?b.name:(0,t.__)("Unknown folder","vmfa-rules-engine");return(0,c.jsxs)("div",{ref:u,style:x,className:"vmfa-rule-item "+(e.enabled?"":"vmfa-rule-item--disabled"),children:[(0,c.jsx)("div",{className:"vmfa-rule-item__drag",...l,...d,children:(0,c.jsx)("span",{className:"dashicons dashicons-menu"})}),(0,c.jsxs)("div",{className:"vmfa-rule-item__content",children:[(0,c.jsxs)("div",{className:"vmfa-rule-item__header",children:[(0,c.jsx)("strong",{className:"vmfa-rule-item__name",children:e.name}),(0,c.jsxs)("span",{className:"vmfa-rule-item__folder",children:["→ ",_]})]}),(0,c.jsxs)("div",{className:"vmfa-rule-item__conditions",children:[e.conditions.length>0?(0,c.jsxs)("span",{children:[e.conditions.length," ",1===e.conditions.length?(0,t.__)("condition","vmfa-rules-engine"):(0,t.__)("conditions","vmfa-rules-engine")]}):(0,c.jsx)("span",{className:"vmfa-rule-item__no-conditions",children:(0,t.__)("No conditions","vmfa-rules-engine")}),e.stop_processing&&(0,c.jsx)("span",{className:"vmfa-rule-item__stop-badge",children:(0,t.__)("Stop","vmfa-rules-engine")})]})]}),(0,c.jsxs)("div",{className:"vmfa-rule-item__actions",children:[(0,c.jsx)(o.ToggleControl,{checked:e.enabled,onChange:n=>a(e.id,n),__nextHasNoMarginBottom:!0}),(0,c.jsx)(o.Button,{icon:h,label:(0,t.__)("Scan with this rule","vmfa-rules-engine"),onClick:()=>s(e)}),(0,c.jsx)(o.Button,{icon:v,label:(0,t.__)("Edit rule","vmfa-rules-engine"),onClick:()=>n(e)}),(0,c.jsx)(o.Button,{icon:f,label:(0,t.__)("Delete rule","vmfa-rules-engine"),isDestructive:!0,onClick:()=>r(e.id)})]})]})}function Qn({stats:e}){return e?(0,c.jsx)(o.Card,{className:"vmfa-stats-card",children:(0,c.jsx)(o.CardBody,{children:(0,c.jsxs)("div",{className:"vmfa-stats-grid",children:[(0,c.jsxs)("div",{className:"vmfa-stats-item",children:[(0,c.jsx)("span",{className:"vmfa-stats-value",children:e.total}),(0,c.jsx)("span",{className:"vmfa-stats-label",children:(0,t.__)("Total Media","vmfa-rules-engine")})]}),(0,c.jsxs)("div",{className:"vmfa-stats-item",children:[(0,c.jsx)("span",{className:"vmfa-stats-value",children:e.assigned}),(0,c.jsx)("span",{className:"vmfa-stats-label",children:(0,t.__)("Assigned","vmfa-rules-engine")})]}),(0,c.jsxs)("div",{className:"vmfa-stats-item",children:[(0,c.jsx)("span",{className:"vmfa-stats-value vmfa-stats-value--highlight",children:e.unassigned}),(0,c.jsx)("span",{className:"vmfa-stats-label",children:(0,t.__)("Unassigned","vmfa-rules-engine")})]}),(0,c.jsxs)("div",{className:"vmfa-stats-item",children:[(0,c.jsx)("span",{className:"vmfa-stats-value",children:e.rules_enabled}),(0,c.jsx)("span",{className:"vmfa-stats-label",children:(0,t.__)("Active Rules","vmfa-rules-engine")})]})]})})}):null}function et(){const{rules:e,isLoading:r,error:s,isSaving:d,createRule:u,updateRule:h,deleteRule:v,reorderRules:f,toggleRule:p}=function(){const[e,t]=(0,n.useState)([]),[r,s]=(0,n.useState)(!0),[i,l]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),{restUrl:d,nonce:u}=window.vmfaRulesEngine||{},h=(0,n.useCallback)(async()=>{s(!0),l(null);try{const e=await a()({path:"vmfa-rules/v1/rules",headers:{"X-WP-Nonce":u}});t(e)}catch(e){l(e.message||"Failed to fetch rules")}finally{s(!1)}},[u]),v=(0,n.useCallback)(async e=>{c(!0),l(null);try{const n=await a()({path:"vmfa-rules/v1/rules",method:"POST",data:e,headers:{"X-WP-Nonce":u}});return t(e=>[...e,n]),n}catch(e){throw l(e.message||"Failed to create rule"),e}finally{c(!1)}},[u]),f=(0,n.useCallback)(async(e,n)=>{c(!0),l(null);try{const r=await a()({path:`vmfa-rules/v1/rules/${e}`,method:"PUT",data:n,headers:{"X-WP-Nonce":u}});return t(n=>n.map(n=>n.id===e?r:n)),r}catch(e){throw l(e.message||"Failed to update rule"),e}finally{c(!1)}},[u]),m=(0,n.useCallback)(async e=>{c(!0),l(null);try{await a()({path:`vmfa-rules/v1/rules/${e}`,method:"DELETE",headers:{"X-WP-Nonce":u}}),t(n=>n.filter(n=>n.id!==e))}catch(e){throw l(e.message||"Failed to delete rule"),e}finally{c(!1)}},[u]),g=(0,n.useCallback)(async e=>{l(null);try{const n=await a()({path:"vmfa-rules/v1/rules/reorder",method:"POST",data:{order:e},headers:{"X-WP-Nonce":u}});return t(n),n}catch(e){throw l(e.message||"Failed to reorder rules"),e}},[u]),p=(0,n.useCallback)(async(n,t)=>{const r=e.find(e=>e.id===n);if(r)return f(n,{...r,enabled:t})},[e,f]);return(0,n.useEffect)(()=>{h()},[h]),{rules:e,isLoading:r,error:i,isSaving:o,fetchRules:h,createRule:v,updateRule:f,deleteRule:m,reorderRules:g,toggleRule:p}}(),{stats:x,refresh:b}=i(),{preview:_,loadMore:y,apply:w,isProcessing:j,isLoadingMore:C,results:S,clearResults:N}=l(),[R,D]=(0,n.useState)(null),[E,k]=(0,n.useState)(!1),[M,I]=(0,n.useState)(!1),[T,B]=(0,n.useState)(""),[A,F]=(0,n.useState)(null),{folders:L=[],strings:O={}}=window.vmfaRulesEngine||{},[P,z]=(0,n.useState)(L),H=(0,n.useRef)(!1),W=(0,n.useRef)(!0);(0,n.useEffect)(()=>(W.current=!0,()=>{W.current=!1}),[]);const U=(0,n.useCallback)(async()=>{if(H.current)return P;H.current=!0;try{const e=await a()({path:"/vmfo/v1/folders"});return Array.isArray(e)&&W.current?(z(e),e):W.current?P:[]}catch(e){return console.error("Failed to fetch folders:",e),W.current?P:[]}finally{H.current=!1}},[P]);(0,n.useEffect)(()=>{const e=()=>{U()};return window.addEventListener("vmf:folders-updated",e),()=>{window.removeEventListener("vmf:folders-updated",e)}},[U]);const X=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,g.useMemo)(()=>[...n].filter(e=>null!=e),[...n])}($(Ue),$(Oe,{coordinateGetter:Xn})),V=(0,n.useCallback)(n=>{const{active:t,over:r}=n;if(t.id!==r?.id){const n=e.findIndex(e=>e.id===t.id),a=e.findIndex(e=>e.id===r.id),s=[...e],[i]=s.splice(n,1);s.splice(a,0,i),f(s.map(e=>e.id))}},[e,f]),q=(0,n.useCallback)(()=>{D(null),k(!0)},[]),K=(0,n.useCallback)(e=>{D(e),k(!0)},[]),Y=(0,n.useCallback)(async e=>{window.confirm(O.deleteConfirm||"Are you sure?")&&await v(e)},[v,O.deleteConfirm]),G=(0,n.useCallback)(async e=>{try{R?await h(R.id,e):await u(e),k(!1),D(null),B(O.saveSuccess||"Rule saved successfully."),setTimeout(()=>B(""),3e3)}catch(e){}},[R,u,h,O.saveSuccess]),[J,Z]=(0,n.useState)(!1),[Q,ee]=(0,n.useState)(!0),ne=(0,n.useCallback)(()=>{F(null),Z(!0)},[]),te=(0,n.useCallback)(e=>{F(e),Z(!0)},[]),re=(0,n.useCallback)(async()=>{Z(!1);const e={unassignedOnly:Q};A&&(e.ruleId=A.id),await _(e),I(!0)},[_,Q,A]),ae=(0,n.useCallback)(async()=>{await y({unassignedOnly:Q})},[y,Q]),se=(0,n.useCallback)(async e=>{await w({attachmentIds:e}),b()},[w,b]),le=(0,n.useCallback)(()=>{I(!1),F(null),N()},[N]);return r?(0,c.jsxs)("div",{className:"vmfa-rules-loading",children:[(0,c.jsx)(o.Spinner,{}),(0,c.jsx)("p",{children:(0,t.__)("Loading rules…","vmfa-rules-engine")})]}):(0,c.jsxs)("div",{className:"vmfa-rules-panel",children:[s&&(0,c.jsx)(o.Notice,{status:"error",isDismissible:!1,children:s}),T&&(0,c.jsx)(o.Notice,{status:"success",isDismissible:!0,onDismiss:()=>B(""),children:T}),(0,c.jsx)(Qn,{stats:x}),(0,c.jsxs)(o.Card,{className:"vmfa-rules-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsxs)(o.Flex,{align:"center",justify:"space-between",children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)("h2",{children:(0,t.__)("Rules","vmfa-rules-engine")})}),(0,c.jsxs)(o.Flex,{gap:2,children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"secondary",onClick:ne,disabled:0===e.length||j,children:j?(0,c.jsx)(o.Spinner,{}):O.dryRun||(0,t.__)("Scan Existing Media","vmfa-rules-engine")})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"primary",icon:m,onClick:q,children:O.addRule||(0,t.__)("Add Rule","vmfa-rules-engine")})})]})]})}),(0,c.jsx)(o.CardBody,{children:0===e.length?(0,c.jsxs)("div",{className:"vmfa-rules-empty",children:[(0,c.jsx)("p",{children:O.noRules||(0,t.__)("No rules configured yet.","vmfa-rules-engine")}),(0,c.jsx)(o.Button,{variant:"primary",icon:m,onClick:q,children:(0,t.__)("Create your first rule","vmfa-rules-engine")})]}):(0,c.jsx)(wn,{sensors:X,collisionDetection:ie,onDragEnd:V,children:(0,c.jsx)(Bn,{items:e.map(e=>e.id),strategy:Mn,children:(0,c.jsx)("div",{className:"vmfa-rules-list",children:e.map(e=>(0,c.jsx)($n,{rule:e,folders:P,onEdit:K,onDelete:Y,onToggle:p,onScan:te},e.id))})})})})]}),E&&(0,c.jsx)(Gn,{rule:R,folders:P,onSave:G,onCancel:()=>{k(!1),D(null)},isSaving:d,onFoldersChange:U}),J&&(0,c.jsxs)(o.Modal,{title:A?(0,t.__)("Scan with Rule","vmfa-rules-engine")+": "+A.name:(0,t.__)("Scan Options","vmfa-rules-engine"),onRequestClose:()=>{Z(!1),F(null)},size:"small",children:[A?(0,c.jsxs)("p",{children:[(0,t.__)("Scan media using only the rule:","vmfa-rules-engine")," ",(0,c.jsx)("strong",{children:A.name})]}):(0,c.jsx)("p",{children:(0,t.__)("Choose which media files to scan.","vmfa-rules-engine")}),(0,c.jsx)(o.CheckboxControl,{label:(0,t.__)("Unassigned media only","vmfa-rules-engine"),help:(0,t.__)("When checked, only media not yet in any folder will be scanned. Uncheck to include all media (may reassign existing).","vmfa-rules-engine"),checked:Q,onChange:ee,__nextHasNoMarginBottom:!0}),(0,c.jsxs)(o.Flex,{justify:"flex-end",style:{marginTop:"16px"},children:[(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"secondary",onClick:()=>{Z(!1),F(null)},children:(0,t.__)("Cancel","vmfa-rules-engine")})}),(0,c.jsx)(o.FlexItem,{children:(0,c.jsx)(o.Button,{variant:"primary",onClick:re,children:(0,t.__)("Run Preview","vmfa-rules-engine")})})]})]}),M&&(0,c.jsx)(Zn,{results:S,onApply:se,onClose:le,onLoadMore:ae,isProcessing:j,isLoadingMore:C})]})}function nt(){return(0,c.jsx)(et,{})}function tt(){return(0,c.jsxs)(o.Card,{className:"vmfo-configure-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsx)("h3",{children:(0,t.__)("Configuration","vmfa-rules-engine")})}),(0,c.jsxs)(o.CardBody,{children:[(0,c.jsx)("p",{children:(0,t.__)("Rules Engine configuration is handled directly through the rule editor in the Dashboard tab. Each rule can be configured with:","vmfa-rules-engine")}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:(0,t.__)("Rule Name:","vmfa-rules-engine")})," ",(0,t.__)("A descriptive name for the rule","vmfa-rules-engine")]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:(0,t.__)("Target Folder:","vmfa-rules-engine")})," ",(0,t.__)("The folder where matched files will be assigned","vmfa-rules-engine")]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:(0,t.__)("Conditions:","vmfa-rules-engine")})," ",(0,t.__)("One or more conditions that must match (filename, type, size, date, author)","vmfa-rules-engine")]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:(0,t.__)("Stop Processing:","vmfa-rules-engine")})," ",(0,t.__)("Whether to stop evaluating subsequent rules when this rule matches","vmfa-rules-engine")]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("strong",{children:(0,t.__)("Enabled:","vmfa-rules-engine")})," ",(0,t.__)("Toggle to enable or disable the rule","vmfa-rules-engine")]})]}),(0,c.jsx)("h4",{children:(0,t.__)("Rule Priority","vmfa-rules-engine")}),(0,c.jsx)("p",{children:(0,t.__)("Rules are evaluated in order from top to bottom. Use drag-and-drop in the Dashboard to reorder rules and control which rules take precedence.","vmfa-rules-engine")})]})]})}function rt(){const{stats:e,refresh:r}=i(),{preview:a,loadMore:s,apply:d,isProcessing:u,isLoadingMore:h,results:v,clearResults:f}=l(),[m,g]=(0,n.useState)(!0),[p,x]=(0,n.useState)(!1),[b,_]=(0,n.useState)(null),y=(0,n.useCallback)(async()=>{try{_(null),await a({unassignedOnly:m}),x(!0)}catch(e){_({type:"error",message:e.message||(0,t.__)("Failed to preview rules.","vmfa-rules-engine")})}},[a,m]),w=(0,n.useCallback)(async()=>{if(window.confirm((0,t.__)("Are you sure you want to apply all rules? This will assign folders to matching media files.","vmfa-rules-engine")))try{_(null);const e=await d({unassignedOnly:m});await r(),_({type:"success",message:N(/* translators: %d: number of files */ /* translators: %d: number of files */
(0,t.__)("Rules applied to %d files.","vmfa-rules-engine"),e?.applied||0)})}catch(e){_({type:"error",message:e.message||(0,t.__)("Failed to apply rules.","vmfa-rules-engine")})}},[d,m,r]),j=(0,n.useCallback)(async()=>{await s({unassignedOnly:m})},[s,m]),C=(0,n.useCallback)(async e=>{try{const n=await d({unassignedOnly:m,attachmentIds:e});await r(),x(!1),f(),_({type:"success",message:N(/* translators: %d: number of files */ /* translators: %d: number of files */
(0,t.__)("Rules applied to %d files.","vmfa-rules-engine"),n?.applied||0)})}catch(e){_({type:"error",message:e.message||(0,t.__)("Failed to apply rules.","vmfa-rules-engine")})}},[d,m,r,f]),S=(0,n.useCallback)(()=>{x(!1),f()},[f]),{sprintf:N}=wp.i18n;return(0,c.jsxs)(c.Fragment,{children:[b&&(0,c.jsx)(o.Notice,{status:b.type,isDismissible:!0,onDismiss:()=>_(null),children:b.message}),(0,c.jsxs)(o.Card,{className:"vmfo-actions-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsx)("h3",{children:(0,t.__)("Batch Operations","vmfa-rules-engine")})}),(0,c.jsxs)(o.CardBody,{children:[(0,c.jsx)("p",{children:(0,t.__)("Apply your rules to existing media files in the library. Use Preview to see what changes will be made before applying.","vmfa-rules-engine")}),(0,c.jsx)("div",{className:"vmfo-actions-options",children:(0,c.jsx)(o.CheckboxControl,{label:(0,t.__)("Only process unassigned media","vmfa-rules-engine"),help:(0,t.__)("When checked, only media files not currently in a folder will be processed.","vmfa-rules-engine"),checked:m,onChange:g})}),e&&(0,c.jsx)("p",{className:"vmfo-actions-stats",children:N(/* translators: %1$d: total media, %2$d: unassigned count */ /* translators: %1$d: total media, %2$d: unassigned count */
(0,t.__)("%1$d total media files, %2$d unassigned.","vmfa-rules-engine"),e.total||0,e.unassigned||0)}),(0,c.jsxs)("div",{className:"vmfo-actions-buttons",children:[(0,c.jsx)(o.Button,{variant:"secondary",onClick:y,disabled:u,children:u?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(o.Spinner,{}),(0,t.__)("Scanning…","vmfa-rules-engine")]}):(0,t.__)("Preview Rules","vmfa-rules-engine")}),(0,c.jsx)(o.Button,{variant:"primary",onClick:w,disabled:u,children:(0,t.__)("Apply Rules to All Media","vmfa-rules-engine")})]})]})]}),(0,c.jsxs)(o.Card,{className:"vmfo-actions-card vmfo-info-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsx)("h3",{children:(0,t.__)("How Batch Operations Work","vmfa-rules-engine")})}),(0,c.jsx)(o.CardBody,{children:(0,c.jsxs)("ol",{children:[(0,c.jsx)("li",{children:(0,t.__)("Rules are evaluated in priority order (top to bottom)","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("Each media file is checked against all enabled rules","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)("When a rule matches, the file is assigned to the target folder","vmfa-rules-engine")}),(0,c.jsx)("li",{children:(0,t.__)('If "Stop Processing" is enabled on a rule, no further rules are checked',"vmfa-rules-engine")})]})})]}),p&&v&&(0,c.jsx)(Zn,{results:v,onClose:S,onApply:C,onLoadMore:j,isLoadingMore:h})]})}function at(){return(0,c.jsxs)(o.Card,{className:"vmfo-logs-card",children:[(0,c.jsx)(o.CardHeader,{children:(0,c.jsx)("h3",{children:(0,t.__)("Activity Logs","vmfa-rules-engine")})}),(0,c.jsx)(o.CardBody,{children:(0,c.jsx)("div",{className:"vmfo-addon-shell__empty-state",children:(0,c.jsx)("p",{children:(0,t.__)("Activity logging is coming in a future update. This will show a history of rule matches, folder assignments, and batch operations.","vmfa-rules-engine")})})})]})}function st(){var e,r,a,l;const{stats:o,isLoading:u}=i(),[h,v]=(0,n.useState)(!0),f=o?[{label:(0,t.__)("Total Rules","vmfa-rules-engine"),value:null!==(e=o.rules_total?.toLocaleString())&&void 0!==e?e:"—"},{label:(0,t.__)("Active Rules","vmfa-rules-engine"),value:null!==(r=o.rules_enabled?.toLocaleString())&&void 0!==r?r:"—"},{label:(0,t.__)("Assigned","vmfa-rules-engine"),value:null!==(a=o.assigned?.toLocaleString())&&void 0!==a?a:"—"},{label:(0,t.__)("Unassigned","vmfa-rules-engine"),value:null!==(l=o.unassigned?.toLocaleString())&&void 0!==l?l:"—"}]:[];return(0,c.jsx)(s.AddonShell,{addonKey:"rules-engine",addonLabel:(0,t.__)("Rules Engine","vmfa-rules-engine"),enabled:h,stats:f,overviewContent:(0,c.jsx)(d,{}),dashboardContent:(0,c.jsx)(nt,{}),configureContent:(0,c.jsx)(tt,{}),actionsContent:(0,c.jsx)(rt,{}),logsContent:(0,c.jsx)(at,{})})}function it(){const e=document.getElementById("vmfa-rules-engine-app");e&&(0,n.createRoot)(e).render((0,c.jsx)(st,{}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",it):it()})();